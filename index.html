<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ケータリングカフェ｜スタバ風チェックリスト（全カテゴリ）</title>
  <style>
    :root{
      --sbx-green:#006241; --sbx-deep:#004c33; --sbx-cream:#f7f3e9; --sbx-paper:#fffdf6; --ink:#1f2937; --muted:#6b7280; --radius:16px;
    }
    *{box-sizing:border-box; transition:all .3s ease;}
    body{margin:0; font-family:ui-sans-serif,system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif; color:var(--ink); background:linear-gradient(180deg,var(--sbx-cream),#fff)}
    header{position:sticky; top:0; z-index:10; background:linear-gradient(180deg,var(--sbx-green),var(--sbx-deep)); color:#fff; padding:16px 20px; box-shadow:0 10px 20px rgba(0,0,0,.1); display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .title{display:flex; align-items:center; gap:12px}
    .bean{width:28px; height:28px; border-radius:50%; background:linear-gradient(135deg,#0a7350 0%,#004c33 100%); position:relative; box-shadow: inset 0 0 0 2px rgba(255,255,255,.15), 0 6px 14px rgba(0,0,0,.2)}
    .bean:before{content:""; position:absolute; top:4px; bottom:4px; left:50%; width:3px; background:#d2e7df; border-radius:2px; transform:translateX(-50%)}
    .subtitle{color:#d1fae5; font-size:12px}

    .toolbar{display:flex; gap:10px; flex-wrap:wrap}
    .btn{background:#fff; color:var(--sbx-green); border:1px solid rgba(0,0,0,.06); padding:10px 14px; border-radius:999px; font-weight:600; cursor:pointer; box-shadow:0 2px 10px rgba(0,0,0,.06); transition:.2s}
    .btn:hover{transform:translateY(-1px); box-shadow:0 6px 14px rgba(0,0,0,.12)}
    .btn.secondary{background:var(--sbx-green); color:#fff; border-color:transparent}
    .btn.ghost{background:transparent; color:#fff; border:1px solid rgba(255,255,255,.35)}

    .wrap{max-width:1100px; margin:28px auto; padding:0 16px}
    .grid{display:flex; flex-direction:column; gap:18px}

    .card{background:var(--sbx-paper); border-radius:var(--radius); padding:14px; border:1px solid rgba(0,0,0,.06); box-shadow:0 10px 24px rgba(0,0,0,.06); overflow:hidden; transition:all .3s ease;}
    .card.collapsed{max-height:40px; padding:8px 14px; box-shadow:0 2px 6px rgba(0,0,0,.1); opacity:.9; order:1000;}
    .card.expanded{order:-1;}
    .card.collapsed:hover{opacity:1; transform:scale(1.02);}

    .card h2{margin:0; font-size:16px; color:var(--sbx-deep); display:flex; align-items:center; justify-content:space-between; gap:10px; cursor:pointer; user-select:none}
    .left{display:flex; align-items:center; gap:8px}
    .caret{display:inline-block; width:0; height:0; border-left:6px solid transparent; border-right:6px solid transparent; border-top:8px solid var(--sbx-deep); transition:transform .2s}
    .card.collapsed .caret{transform:rotate(-90deg)}

    .list{list-style:none; padding:0; margin:8px 0 0 0; transition:all .3s ease;}
    .card.collapsed .list{display:none;}

    .row{display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:12px; border:1px dashed rgba(0,0,0,.06); margin-bottom:6px; background:#fff; cursor:grab; transition:.2s}
    .row:hover{border-color:rgba(0,98,65,.25); box-shadow:0 4px 10px rgba(0,0,0,.04)}
    .row.dragging{opacity:.5; transform:scale(1.02);}

    input[type="checkbox"]{width:18px; height:18px; cursor:pointer; accent-color:var(--sbx-green)}
    label{cursor:pointer}
    .item{flex:1}
    .qty{width:60px; text-align:center; border:1px solid #ccc; border-radius:8px; padding:4px; font-size:13px}

    footer{max-width:1100px; margin:20px auto 40px; padding:0 16px; color:var(--muted); font-size:12px}
  </style>
</head>
<body>
  <header>
    <div class="title">
      <span class="bean"></span>
      <div>
        <div style="font-size:18px; font-weight:800;">ケータリングカフェ｜チェックリスト</div>
        <div class="subtitle">開閉で自動整理・枠縮小／ドラッグ並べ替え／数量入力／保存</div>
      </div>
    </div>
    <div class="toolbar">
      <button class="btn secondary" id="printBtn">印刷</button>
      <button class="btn" id="exportBtn">CSV書き出し</button>
      <button class="btn ghost" id="resetBtn">全リセット</button>
    </div>
  </header>
  <div class="wrap"><div class="grid" id="grid"></div></div>
  <footer>※ 状態は自動保存されます（localStorage）。</footer>
  <script>
    const initialData={
      "運搬関係":["脚立","テーブル","台車","延長ケーブル2つ","発泡スチロール箱","ゴミ箱ゴミ袋","排水ゴムバケツ"],
      "装飾関係":["小さいメニューボード","サインボード","テーブルクロス","ディスプレイ小物"],
      "コンディメント関係":["ガムシロップ","ストロー","ホットカップ","アイスカップ","リッド","マドラー","ダスター","アルコール","サランラップ","透明水タンク"],
      "エスプレッソ関係":["エスプレッソマシン(オスカー2)","グラインダー","ピッチャー5個","タンパー","タンピングマット","レベラー","量り","卓上用ノックボックス","ブラインドフィルター","マイナスドライバー","ステンレスショットグラス2個"],
      "ドリンク関係":["コーヒー豆","抹茶粉","ほうじ茶粉","ソーダストリーム(ボトル2本)","ケトル","製氷機","小型冷蔵庫","パウダーオペレーションセット"]
    };

    const STORE_KEY='catering-checklist-v7';
    const slug=s=>s.replace(/[\(\)\s・・/]/g,'-');
    const load=()=>{try{return JSON.parse(localStorage.getItem(STORE_KEY))||{};}catch{return {};}};
    const save=s=>localStorage.setItem(STORE_KEY,JSON.stringify(s));
    const state=load();
    if(!state.layout)state.layout=JSON.parse(JSON.stringify(initialData));
    if(!state.checked)state.checked={};
    if(!state.qty)state.qty={};
    if(!state.collapsed)state.collapsed={};

    const grid=document.getElementById('grid');

    function render(){
      grid.innerHTML='';
      const sorted=Object.entries(state.layout).sort(([a],[b])=>{const ca=state.collapsed[a]?1:0; const cb=state.collapsed[b]?1:0; return ca-cb;});
      sorted.forEach(([cat,items])=>{
        const card=document.createElement('section');card.className='card';if(state.collapsed[cat])card.classList.add('collapsed'); else card.classList.add('expanded');
        const h2=document.createElement('h2');const left=document.createElement('div');left.className='left';const caret=document.createElement('span');caret.className='caret';left.append(caret,document.createTextNode(cat));h2.append(left);
        h2.onclick=e=>{state.collapsed[cat]=!state.collapsed[cat];save(state);render();};
        const ul=document.createElement('ul');ul.className='list';ul.dataset.cat=cat;
        ul.ondragover=e=>{e.preventDefault();ul.classList.add('dragover');};ul.ondragleave=()=>ul.classList.remove('dragover');
        ul.ondrop=e=>{e.preventDefault();ul.classList.remove('dragover');const label=e.dataTransfer.getData('text/plain');const fromCat=e.dataTransfer.getData('text/fromCat');const idx=e.dataTransfer.getData('text/idx');if(fromCat===cat){const el=state.layout[cat].splice(idx,1)[0];state.layout[cat].push(el);}else{const i=state.layout[fromCat].indexOf(label);if(i>-1)state.layout[fromCat].splice(i,1);state.layout[cat].push(label);}save(state);render();};
        items.forEach((label,i)=>{
          const li=document.createElement('li');li.className='row';li.draggable=true;
          li.ondragstart=e=>{li.classList.add('dragging');e.dataTransfer.setData('text/plain',label);e.dataTransfer.setData('text/fromCat',cat);e.dataTransfer.setData('text/idx',i);};
          li.ondragend=()=>li.classList.remove('dragging');
          const cb=document.createElement('input');cb.type='checkbox';cb.checked=!!state.checked[label];cb.onchange=()=>{state.checked[label]=cb.checked;save(state);};
          const lab=document.createElement('label');lab.className='item';lab.textContent=label;
          const qty=document.createElement('input');qty.type='number';qty.className='qty';qty.min='0';qty.step='1';qty.value=(state.qty[label] ?? 1);qty.onchange=()=>{const v=parseInt(qty.value,10);state.qty[label]=(Number.isFinite(v) && v>=0)?v:1;qty.value=state.qty[label];save(state);};
          li.append(cb,lab,qty);ul.append(li);
        });
        card.append(h2,ul);grid.append(card);
      });
    }

    render();
    document.getElementById('printBtn').onclick=()=>window.print();
    document.getElementById('resetBtn').onclick=()=>{if(confirm('全リセットしますか？')){localStorage.removeItem(STORE_KEY);location.reload();}};
    document.getElementById('exportBtn').onclick=()=>{
      const lines=['カテゴリ,アイテム,チェック,数量'];Object.entries(state.layout).forEach(([cat,items])=>{items.forEach(label=>{const esc=s=>'"'+s.replaceAll('"','""')+'"';lines.push([esc(cat),esc(label),state.checked[label]?1:0,(state.qty[label] ?? 1)].join(','));});});
      const blob=new Blob([lines.join('\n')],{type:'text/csv;charset=utf-8;'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='チェックリスト.csv';a.click();};
  </script>
</body>
</html>
