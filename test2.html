<!DOCTYPE html><html lang="ja"><head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ケータリングカフェ｜スタバ風チェックリスト（折りたたみ付き）</title>
  <meta name="theme-color" content="#006241">
  <meta property="og:title" content="ケータリングカフェ｜スタバ風チェックリスト">
  <meta property="og:description" content="数量入力／CSV入出力／印刷／取り消し（Undo）対応。カテゴリ開閉機能付き。">
  <meta property="og:type" content="website">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 32 32%22><circle cx=%2216%22 cy=%2216%22 r=%2216%22 fill=%22%23006241%22/><path d=%22M16 6c4 0 7 3 7 7s-3 7-7 7-7-3-7-7 3-7 7-7Z%22 fill=%22white%22/></svg>">
  <style>
    :root{ --sbx-green:#006241; --sbx-deep:#004c33; --sbx-cream:#f7f3e9; --sbx-paper:#fffdf6; --ink:#1f2937; --muted:#6b7280; --radius:16px; }
    *{box-sizing:border-box; transition:all .3s ease;}
    body{margin:0; font-family:ui-sans-serif,system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif; color:var(--ink); background:linear-gradient(180deg,var(--sbx-cream),#fff)}
    header{position:sticky; top:0; z-index:10; background:linear-gradient(180deg,var(--sbx-green),var(--sbx-deep)); color:#fff; padding:16px 20px; box-shadow:0 10px 20px rgba(0,0,0,.1); display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .title{display:flex; align-items:center; gap:12px}
    .bean{width:28px; height:28px; border-radius:50%; background:linear-gradient(135deg,#0a7350 0%,#004c33 100%); position:relative; box-shadow: inset 0 0 0 2px rgba(255,255,255,.15), 0 6px 14px rgba(0,0,0,.2)}
    .bean:before{content:""; position:absolute; top:4px; bottom:4px; left:50%; width:3px; background:#d2e7df; border-radius:2px; transform:translateX(-50%)}
    .subtitle{color:#d1fae5; font-size:12px}
    .toolbar{display:flex; gap:10px; flex-wrap:wrap}
    .btn{background:#fff; color:var(--sbx-green); border:1px solid rgba(0,0,0,.06); padding:10px 14px; border-radius:999px; font-weight:600; cursor:pointer; box-shadow:0 2px 10px rgba(0,0,0,.06);}
    .btn:hover{transform:translateY(-1px); box-shadow:0 6px 14px rgba(0,0,0,.12)}
    .btn.secondary{background:var(--sbx-green); color:#fff; border-color:transparent}
    .btn.ghost{background:transparent; color:#fff; border:1px solid rgba(255,255,255,.35)}
    .btn[disabled]{opacity:.45; cursor:not-allowed}
    .wrap{max-width:1100px; margin:28px auto; padding:0 16px}
    .grid{display:flex; flex-direction:column; gap:18px}

    .card{background:var(--sbx-paper); border-radius:var(--radius); padding:14px; border:1px solid rgba(0,0,0,.06); box-shadow:0 10px 24px rgba(0,0,0,.06);}
    .card h2{margin:0; font-size:16px; color:var(--sbx-deep); display:flex; align-items:center; justify-content:space-between; gap:10px; cursor:pointer; user-select:none}
    .card h2::after{content:"▼"; font-size:12px; color:var(--sbx-green); transition:.3s;}
    .card.folded h2::after{transform:rotate(-90deg); opacity:.6;}
    .list{list-style:none; padding:0; margin:8px 0 0 0; transition:max-height .4s ease, opacity .4s ease;}
    .list.folded{max-height:0; opacity:0; overflow:hidden;}

    .row{display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:12px; border:1px dashed rgba(0,0,0,.06); margin-bottom:6px; background:#fff;}
    .row:hover{border-color:rgba(0,98,65,.25); box-shadow:0 4px 10px rgba(0,0,0,.04)}

    input[type="checkbox"]{width:18px; height:18px; cursor:pointer; accent-color:var(--sbx-green)}
    label{cursor:pointer}
    .item{flex:1}
    .qty{width:60px; text-align:center; border:1px solid #ccc; border-radius:8px; padding:4px; font-size:13px}

    .h2-actions{display:flex; gap:6px}
    .chip{font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid rgba(0,0,0,.06); background:#fff; color:var(--sbx-green); cursor:pointer}

    footer{max-width:1100px; margin:20px auto 40px; padding:0 16px; color:var(--muted); font-size:12px}

    @media print{ header, footer{ display:none !important; } .card{ max-height:none !important; } body{ background:#fff !important; } }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <span class="bean"></span>
      <div>
        <div style="font-size:18px; font-weight:800;">ケータリングカフェ｜チェックリスト</div>
        <div class="subtitle">カテゴリ固定順（エスプ→ドリンク→コンディメント→運搬→装飾→フローズンソーダ）</div>
      </div>
    </div>
    <div class="toolbar">
      <button class="btn secondary" id="printBtn">印刷</button>
      <button class="btn" id="importBtn">CSV読み込み</button>
      <input type="file" id="csvFile" accept=".csv" style="display:none">
      <button class="btn" id="exportBtn">CSV書き出し</button>
      <button class="btn ghost" id="resetBtn">全リセット</button>
    </div>
  </header>

  <div class="wrap"><div class="grid" id="grid"></div></div>
  <footer>※ 状態は自動保存されます（localStorage）。カテゴリ開閉やチェック内容も保持されます。</footer>

  <script>
    const initialData={
      "エスプレッソ関係":["エスプレッソマシン(オスカー2)","グラインダー","ピッチャー5個","タンパー","タンピングマット","レベラー","量り","卓上用ノックボックス","ブラインドフィルター","マイナスドライバー","ステンレスショットグラス2個"],
      "ドリンク関係":["コーヒー豆","抹茶粉","ほうじ茶粉","ソーダストリーム(ボトル2本)","ケトル","製氷機","小型冷蔵庫","パウダーオペレーションセット"],
      "コンディメント関係":["ガムシロップ","ストロー","ホットカップ","アイスカップ","リッド","マドラー","ダスター","アルコール","サランラップ","透明水タンク"],
      "運搬関係":["脚立","テーブル","台車","延長ケーブル2つ","発泡スチロール箱","ゴミ箱ゴミ袋","排水ゴムバケツ"],
      "装飾関係":["小さいメニューボード","サインボード","テーブルクロス","ディスプレイ小物"],
      "フローズン・ソーダ関係":["グラニータマシン","フローズン原料","ソーダストリーム","炭酸ボトル","フローズンカップ","ワイドストロー"]
    };
    const ORDER=["エスプレッソ関係","ドリンク関係","コンディメント関係","運搬関係","装飾関係","フローズン・ソーダ関係"];
    const STORE_KEY='catering-checklist-foldable';

    const load=()=>{try{return JSON.parse(localStorage.getItem(STORE_KEY))||{};}catch{return {}}};
    const save=s=>localStorage.setItem(STORE_KEY,JSON.stringify(s));
    const state=load();
    if(!state.checked)state.checked={};
    if(!state.qty)state.qty={};
    if(!state.folded)state.folded={};

    const makeId=(cat,label)=>'cb-'+(cat+'-'+label).replace(/\s+/g,'-').replace(/[^\w\-]/g,'');

    function render(){
      const grid=document.getElementById('grid');
      grid.innerHTML='';
      ORDER.forEach(cat=>{
        const card=document.createElement('section');
        card.className='card';
        if(state.folded[cat]) card.classList.add('folded');

        const h2=document.createElement('h2');
        h2.textContent=cat;
        h2.onclick=()=>{
          state.folded[cat]=!state.folded[cat];
          save(state);
          render();
        };

        const addBtn=document.createElement('span');
        addBtn.className='chip';
        addBtn.textContent='アイテム追加';
        addBtn.onclick=(e)=>{
          e.stopPropagation();
          const name=prompt('追加するアイテム名を入力');
          if(!name||!name.trim())return;
          initialData[cat].push(name.trim());
          save(state);
          render();
        };

        const actions=document.createElement('div');
        actions.className='h2-actions';
        actions.append(addBtn);
        h2.append(actions);

        const ul=document.createElement('ul');
        ul.className='list';
        if(state.folded[cat]) ul.classList.add('folded');

        initialData[cat].forEach(label=>{
          const li=document.createElement('li');
          li.className='row';
          const id=makeId(cat,label);
          const cb=document.createElement('input');
          cb.type='checkbox';
          cb.id=id;
          cb.checked=!!state.checked[label];
          cb.onchange=()=>{state.checked[label]=cb.checked; save(state)};
          const lab=document.createElement('label');
          lab.className='item';
          lab.textContent=label;
          lab.setAttribute('for',id);
          const qty=document.createElement('input');
          qty.type='number';
          qty.className='qty';
          qty.min='0'; qty.step='1';
          qty.value=(state.qty[label]??1);
          qty.onchange=()=>{
            const v=parseInt(qty.value,10);
            state.qty[label]=(Number.isFinite(v)&&v>=0)?v:1;
            qty.value=state.qty[label];
            save(state)
          };
          li.append(cb,lab,qty);
          ul.append(li);
        });

        card.append(h2,ul);
        grid.append(card);
      });
    }

    render();

    document.getElementById('printBtn').onclick=()=>window.print();
    document.getElementById('resetBtn').onclick=()=>{
      if(confirm('全リセットしますか？')){
        localStorage.removeItem(STORE_KEY);
        location.reload();
      }
    };

    document.getElementById('exportBtn').onclick=()=>{
      const lines=['カテゴリ,アイテム,チェック,数量'];
      ORDER.forEach(cat=>{
        initialData[cat].forEach(label=>{
          const esc=s=>'"'+String(s).replaceAll('"','""')+'"';
          lines.push([esc(cat),esc(label),state.checked[label]?1:0,(state.qty[label]??1)].join(','));
        });
      });
      const blob=new Blob([lines.join('\n')],{type:'text/csv;charset=utf-8;'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='チェックリスト.csv';
      a.click();
    };

    const csvFile=document.getElementById('csvFile');
    document.getElementById('importBtn').onclick=()=>csvFile.click();
    csvFile.onchange=e=>{
      const file=e.target.files[0];
      if(!file)return;
      const r=new FileReader();
      r.onload=()=>loadCsv(r.result);
      r.readAsText(file,'utf-8');
      e.target.value='';
    };

    function parseCsv(t){
      const r=[];let i=0,f='',row=[],q=false;
      while(i<t.length){
        const c=t[i];
        if(q){
          if(c=='"'){if(t[i+1]=='"'){f+='"';i+=2;continue;}q=false;i++;continue;}
          else{f+=c;i++;continue;}
        }else{
          if(c=='"'){q=true;i++;continue;}
          if(c==','){row.push(f);f='';i++;continue;}
          if(c=='\n'||c=='\r'){if(f!==''||row.length>0){row.push(f);r.push(row);row=[];f='';}i++;continue;}
          f+=c;i++;
        }
      }
      if(f!==''||row.length>0){row.push(f);r.push(row);}
      return r.filter(r=>r.length>0);
    }

    function loadCsv(t){
      const rows=parseCsv(t);
      if(!rows.length)return alert('CSVが空です');
      const h=rows[0].map(s=>s.trim());
      const ic=h.indexOf('アイテム');const ck=h.indexOf('チェック');const qy=h.indexOf('数量');
      if(ic<0)return alert('アイテム列が必要です');
      rows.slice(1).forEach(cols=>{
        const l=(cols[ic]||'').trim();if(!l)return;
        if(ck>=0){const c=(cols[ck]||'').trim();state.checked[l]=(c==='1'||c.toLowerCase()==='true');}
        if(qy>=0){const q=parseInt((cols[qy]||'1').trim(),10);state.qty[l]=(Number.isFinite(q)&&q>=0)?q:1;}
      });
      save(state);render();alert('CSVを読み込みました');
    }
  </script>
</body>
</html>
