<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>英単語暗記チェックリスト｜Ader Blue Light（訳トグル＋シール剥がしv2）</title>
  <meta name="theme-color" content="#4C6FFF">
  <style>
    :root{
      --bg:#F7F8FB; --paper:#FFFFFF; --ink:#1F2430; --muted:#6F7787; --line:#E7EAF0;
      --primary:#4C6FFF; --primary-ink:#FFFFFF; --primary-soft:#EDF2FF; --primary-soft-2:#CCD7FF;
      --ok:#12a150; --ok-soft:#E6F6EA; --radius:16px; --shadow:0 10px 28px rgba(18,25,38,.08);

      /* Sticker theme */
      --sticker-bg: linear-gradient(135deg,#fff 0%,var(--primary-soft) 65%,#fff 100%);
      --sticker-edge: var(--primary-soft-2);
      --sticker-gloss: linear-gradient(180deg,rgba(255,255,255,.9),rgba(255,255,255,0));
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,"Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;letter-spacing:.2px}

    /* Header */
    header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(1.05) blur(6px);
      background:linear-gradient(180deg,rgba(255,255,255,.9),rgba(255,255,255,.7));
      border-bottom:1px solid var(--line);padding:14px 18px;display:flex;gap:14px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:18px;height:28px;background:var(--primary);border-radius:4px;box-shadow:0 8px 24px rgba(76,111,255,.28)}
    .title{font-weight:800;letter-spacing:.3px}
    .sub{font-size:12px;color:var(--muted)}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap}
    .btn{background:var(--primary);color:var(--primary-ink);border:1px solid var(--primary);padding:8px 14px;border-radius:999px;font-weight:700;cursor:pointer;box-shadow:0 6px 16px rgba(76,111,255,.18)}
    .btn:hover{transform:translateY(-1px)}
    .btn.ghost{background:#fff;color:var(--primary);border-color:var(--primary);box-shadow:none}

    /* Layout */
    .wrap{max-width:970px;margin:24px auto;padding:0 18px}
    .grid{display:flex;flex-direction:column;gap:16px}
    .card{background:var(--paper);border:1px solid var(--line);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
    .card h2{margin:0;font-size:16px;display:flex;align-items:center;gap:12px;position:relative;padding-right:40px;cursor:pointer;user-select:none}
    .card h2 .hint{font-size:12px;color:var(--muted);font-weight:500}
    .card h2::after{content:"▾";position:absolute;right:8px;top:50%;transform:translateY(-50%);color:#9AA2B1;font-size:14px}
    .card.folded h2::after{transform:translateY(-50%) rotate(-90deg);opacity:.8}
    .h2-actions{margin-left:auto;display:flex;align-items:center;gap:8px}
    .chip{font-size:11px;padding:6px 12px;border-radius:999px;border:1px solid var(--primary);background:var(--primary-soft);color:var(--primary);cursor:pointer;font-weight:700}

    /* List rows */
    .list{list-style:none;padding:0;margin:12px 0 0 0;transition:max-height .35s ease, opacity .35s ease}
    .list.folded{max-height:0;opacity:0;overflow:hidden}
    .row{display:grid;grid-template-columns:auto 1fr auto auto;gap:12px;align-items:center;padding:12px;border:1px solid var(--line);border-radius:12px;background:#fff}
    .row + .row{margin-top:8px}
    .row:hover{border-color:#DDE2EE;box-shadow:0 6px 14px rgba(10,20,40,.06)}
    .word{font-weight:800}
    .ipa{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;color:#4C5567;opacity:.95}
    .jp{color:#2b2b2b;position:relative;isolation:isolate}

    input[type="checkbox"]{width:18px;height:18px;cursor:pointer;accent-color:var(--ok)}
    footer{max-width:970px;margin:20px auto 34px;padding:0 18px;color:var(--muted);font-size:12px}
    @media print{header,footer{display:none!important}body{background:#fff}.card{break-inside:avoid}}
    @media (max-width:560px){.row{grid-template-columns:1fr 1fr}.ipa{order:3}.jp{order:2}}

    /* ====== 高品位な覆い（非表示時） ====== */
    .jp.covered::before{
      content:"";position:absolute;inset:0;border-radius:12px;z-index:0;
      background:
        /* 繊維感 */
        repeating-linear-gradient(135deg, rgba(76,111,255,.08) 0 2px, rgba(255,255,255,.9) 2px 4px),
        var(--sticker-bg);
      border:1px solid var(--sticker-edge);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.7),
        0 6px 14px rgba(18,25,38,.10);
    }

    /* ====== Peel v2（ステッカーの形と動作） ====== */
    .peel{
      --w:120px; --h:22px; /* JSで実サイズが入る */
      position:absolute; left:0; top:0; width:var(--w); height:var(--h);
      pointer-events:none; border-radius:12px; overflow:visible; transform-origin:20% 20%;
      filter:drop-shadow(0 10px 22px rgba(18,25,38,.12));
    }
    /* 本体のシート */
    .peel .sheet{
      position:absolute; inset:0; border-radius:12px; background:var(--sticker-bg);
      border:1px solid var(--sticker-edge);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.75);
      /* 光沢ストリップ */
      -webkit-mask-image: radial-gradient(14px 14px at 96% 0, rgba(0,0,0,.9), rgba(0,0,0,0.6) 60%, transparent 61%),
                          linear-gradient(#000,#000);
      mask-image: radial-gradient(14px 14px at 96% 0, rgba(0,0,0,.9), rgba(0,0,0,0.6) 60%, transparent 61%),
                  linear-gradient(#000,#000);
      -webkit-mask-composite: source-over;
              mask-composite: add;
    }
    /* 角のカール（右上が少しめくれる） */
    .peel .curl{
      position:absolute; right:-2px; top:-2px; width:26px; height:26px;
      background:radial-gradient(18px 18px at 70% 30%, rgba(255,255,255,.9), rgba(255,255,255,0) 70%),
                 radial-gradient(16px 16px at 0% 100%, rgba(0,0,0,.10), transparent 60%);
      clip-path:polygon(100% 0, 0 0, 100% 100%);
      transform-origin:0% 100%; border-top-right-radius:10px;
      border-right:1px solid rgba(0,0,0,.06); border-top:1px solid rgba(0,0,0,.04);
    }
    /* プルタブ（小さな丸シール） */
    .peel .tab{
      position:absolute; left:-8px; top:50%; width:18px; height:18px; margin-top:-9px; border-radius:50%;
      background:#fff; border:1px solid var(--sticker-edge);
      box-shadow:0 2px 6px rgba(18,25,38,.12), inset 0 1px 0 rgba(255,255,255,.8);
    }
    .peel .gloss{
      content:""; position:absolute; left:0; right:0; top:0; height:40%;
      background:var(--sticker-gloss); border-radius:12px 12px 0 0; pointer-events:none; opacity:.65;
    }

    /* 実行中のアニメ（シートが斜めにスイープ＋カールがふわっと） */
    .peel.run .sheet{ animation:peelSweep .8s cubic-bezier(.2,.8,.2,1) forwards }
    .peel.run .curl{ animation:curlLift .8s cubic-bezier(.2,.8,.2,1) forwards }
    .peel.run .tab{ animation:tabWiggle .8s ease-out forwards .05s }

    @keyframes peelSweep{
      0%{
        transform:rotateX(0) rotateZ(0) translate(0,0);
        clip-path:polygon(0 0,100% 0,100% 100%,0 100%);
        opacity:1;
      }
      45%{
        transform:rotateX(18deg) rotateZ(-2deg) translate(-2px,-4px);
        clip-path:polygon(0 0,100% 0,85% 100%,0 100%);
      }
      75%{
        transform:rotateX(42deg) rotateZ(-5deg) translate(-6px,-12px);
        clip-path:polygon(0 0,80% 0,55% 100%,0 100%);
      }
      100%{
        transform:rotateX(70deg) rotateZ(-8deg) translate(-10px,-20px);
        clip-path:polygon(0 0,60% 0,0 100%,0 100%);
        opacity:0;
      }
    }
    @keyframes curlLift{
      0%{ transform:rotateX(0) rotateZ(0) scale(1); opacity:.9 }
      40%{ transform:rotateX(25deg) rotateZ(-8deg) scale(1.03) }
      100%{ transform:rotateX(55deg) rotateZ(-14deg) scale(1.05); opacity:0 }
    }
    @keyframes tabWiggle{
      0%{ transform:translateX(0) }
      35%{ transform:translateX(-2px) }
      65%{ transform:translateX(-5px) }
      100%{ transform:translateX(-8px); opacity:0 }
    }

    /* 低速・乗り物酔い配慮 */
    @media (prefers-reduced-motion:reduce){
      .peel.run .sheet,.peel.run .curl,.peel.run .tab{ animation-duration:.01ms!important; animation-iteration-count:1!important }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <span class="logo"></span>
      <div>
        <div class="title">英単語暗記チェックリスト</div>
        <div class="sub">カテゴリ右上のボタンで訳を表示/非表示。ライト×淡ブルーで集中しやすく。</div>
      </div>
    </div>
    <div class="toolbar">
      <button class="btn" id="printBtn">印刷</button>
      <button class="btn ghost" id="resetBtn">全リセット</button>
    </div>
  </header>

  <div class="wrap"><div class="grid" id="grid"></div></div>
  <footer>状態は自動保存（localStorage）。単語セットは下の <code>initialData</code> を編集してください。</footer>

  <script>
    /* 単語データ（例）— { w, ipa, jp } */
    const initialData = {
      "動詞":[
        { w:"acquire", ipa:"/əˈkwaɪər/", jp:"獲得する" },
        { w:"assume",  ipa:"/əˈsuːm/",  jp:"仮定する・引き受ける" },
        { w:"pursue",  ipa:"/pərˈsuː/", jp:"追求する" },
        { w:"refine",  ipa:"/rɪˈfaɪn/", jp:"磨く・洗練する" }
      ],
      "形容詞":[
        { w:"subtle", ipa:"/ˈsʌt̬.əl/", jp:"微妙な・繊細な" },
        { w:"robust", ipa:"/roʊˈbʌst/", jp:"頑丈な・力強い" },
        { w:"feasible", ipa:"/ˈfiː.zə.bəl/", jp:"実行可能な" }
      ],
      "副詞":[
        { w:"roughly", ipa:"/ˈrʌf.li/", jp:"おおよそ" },
        { w:"literally", ipa:"/ˈlɪt̬.ər.əl.i/", jp:"文字通り" }
      ],
      "名詞":[
        { w:"insight", ipa:"/ˈɪn.saɪt/", jp:"洞察" },
        { w:"trajectory", ipa:"/trəˈdʒek.tər.i/", jp:"軌道・軌跡" }
      ],
      "前置詞":[
        { w:"beyond", ipa:"/biˈjɑːnd/", jp:"〜を超えて" },
        { w:"within", ipa:"/wɪˈðɪn/", jp:"〜以内に／〜の内側に" }
      ]
    };

    const ORDER = ["動詞","形容詞","副詞","名詞","前置詞"];
    const STORE_KEY = "vocab-deck-v3-ader-light";

    const load = () => { try { return JSON.parse(localStorage.getItem(STORE_KEY))||{} } catch { return {} } };
    const save = s => localStorage.setItem(STORE_KEY, JSON.stringify(s));
    const state = load();
    if(!state.known) state.known = {};
    if(!state.folded) state.folded = {};
    if(!state.showJP) state.showJP = {};

    let lastToggle = { cat:null, toShow:false };

    const makeId = (cat, w) => 'id-'+(cat+'-'+w).replace(/\s+/g,'-').replace(/[^\w\-]/g,'');

    function render(){
      const grid = document.getElementById('grid');
      grid.innerHTML = '';

      ORDER.forEach(cat => {
        const card = document.createElement('section');
        card.className = 'card' + (state.folded[cat] ? ' folded' : '');

        const h2 = document.createElement('h2');
        h2.innerHTML = `${cat} <span class="hint">単語 / 発音 / 日本語訳</span>`;
        h2.onclick = () => { state.folded[cat] = !state.folded[cat]; save(state); render(); };

        // 訳の表示/非表示（カテゴリ単位）
        const toggleJP = document.createElement('span');
        toggleJP.className = 'chip';
        const show = !!state.showJP[cat];
        toggleJP.textContent = show ? '訳を非表示' : '訳を表示';
        toggleJP.onclick = (e)=>{
          e.stopPropagation();
          const toShow = !state.showJP[cat];
          state.showJP[cat] = toShow; save(state);
          lastToggle = { cat, toShow };
          render();
        };

        const actions = document.createElement('div');
        actions.className = 'h2-actions';
        actions.append(toggleJP);
        h2.append(actions);

        const ul = document.createElement('ul');
        ul.className = 'list' + (state.folded[cat] ? ' folded' : '');

        (initialData[cat]||[]).forEach(item => {
          const li = document.createElement('li');
          li.className = 'row';
          const id = makeId(cat, item.w);

          const cb = document.createElement('input');
          cb.type = 'checkbox'; cb.id = id;
          cb.checked = !!state.known[item.w];
          cb.onchange = () => { state.known[item.w] = cb.checked; save(state); };

          const word = document.createElement('div');
          word.className = 'word'; word.textContent = item.w;

          const ipa = document.createElement('div');
          ipa.className = 'ipa'; ipa.textContent = item.ipa || '';

          const jp = document.createElement('div');
          jp.className = 'jp' + (state.showJP[cat] ? '' : ' covered');
          jp.textContent = item.jp || '';

          li.append(cb, word, ipa, jp);
          ul.append(li);
        });

        card.append(h2, ul);
        grid.append(card);

        // 直前に「表示」にしたカテゴリだけ、剥がしアニメを実行
        if(lastToggle.cat === cat && lastToggle.toShow){
          peelReveal(ul);
        }
      });
    }

    // ====== v2：剥がすアニメーション（上質な形＆動作） ======
    function peelReveal(container){
      const targets = container.querySelectorAll('.jp');
      targets.forEach((jp, idx) => {
        // 既存の覆い要素をクリア
        jp.querySelectorAll('.peel').forEach(n => n.remove());

        // 覆いを生成
        const r = jp.getBoundingClientRect();
        const peel = document.createElement('span');
        peel.className = 'peel';
        peel.style.setProperty('--w', r.width + 'px');
        peel.style.setProperty('--h', r.height + 'px');

        const sheet = document.createElement('span'); sheet.className = 'sheet';
        const curl  = document.createElement('span'); curl.className  = 'curl';
        const tab   = document.createElement('span'); tab.className   = 'tab';
        const gloss = document.createElement('span'); gloss.className = 'gloss';
        peel.append(sheet, curl, tab, gloss);

        jp.appendChild(peel);
        // 非表示スタイル解除（下の日本語を見せる）
        jp.classList.remove('covered');

        // 連続で剥がしていくディレイ
        const delay = idx * 55; // ms
        setTimeout(() => {
          peel.classList.add('run');
        }, delay);

        // アニメ終了で要素を除去
        sheet.addEventListener('animationend', () => peel.remove(), { once:true });
      });
    }

    render();

    document.getElementById('printBtn').onclick = () => window.print();
    document.getElementById('resetBtn').onclick = () => {
      if(confirm('全リセットしますか？\n（開閉・覚えた・訳表示の状態を削除）')){
        localStorage.removeItem(STORE_KEY);
        location.reload();
      }
    };
  </script>
</body>
</html>